# VMware配置网络/Linux

[TOC]

## 配置交换机策略

首先打开虚拟网络编辑器页面, 这里为了方便开发我们使用NAT模式

如果是桥接模式, 由于是将真实网卡与交换机相连，想要上网虚拟机的IP必须与真实网卡的IP相同。

如果是仅主机，是将adaptor vmnet1 与交换机相连，但是没有和真实网卡相连，所以在该模式下不能上外网。

如果是NAT，是将adaptor vment8 还有真实网卡与交换机相连，所以可以与虚拟机通信，也能上外网

<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-08-23_22-32-19.png" style="zoom:80%;" />

- 子网IP和子网掩码可以规则任意设置

- DHCP广播范围，可以只定义

  <img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-08-23_22-40-58.png" style="zoom:80%;" />
>vmware交换机自带DHCP服务器
>
>只要是同一网段的就可以ping通，即使不在DHCP广播范围内，这只表示该IP不能通过DHCP获取动态IP
>
>可以关闭交换机DHCP，使用服务器替代

  - NAT配置网关, 网关可以是在广播范围内的任意一个数字（==除1外，1做为宿主机adaptor vment8的host-id 且使用该网卡的虚拟机的IP地址不能与网关相同）==

<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-09-01_14-44-45.png"/>

如果主机可以ping通虚拟机, 就说明交换机配置的网段没有问题, 且虚拟机不能上网, 及有可能时DNS错误

修改虚拟机DNS配置, 如果还是未生效, 按照下图设置, ==也有可能使用nmap导致当前dns失效==

<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-09-02_18-40-34.png" style="zoom:80%;" />

## 配置Linux网卡

通过`ifconfig`查看当前的网卡，确认为`ens32`

<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-08-23_22-51-39.png" style="zoom:80%;" />

删除virbro具体参考: https://blog.51cto.com/xjsunjie/1914963

### 修改配置文件

`cd /etc/sysconfig/network-script`

<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-08-23_23-09-09.png" style="zoom:80%;" />

这里推荐先到文件目录然后通过`vim ifcfg-ens32`命令修改, ==防止有多的网卡配置导致配置失效==而抛出异常

```shell
Restarting network (via systemctl):  Job for network.service failed because the control process exited with error code. See "systemctl status network.service" and "journalctl -xe" for details.

```

配置参数参考: https://blog.csdn.net/weixin_43928833/article/details/100983032

> 默认电脑重启后网络不会开启，设置`ONBOOT=yes`

```shell
TYPE="Ethernet"		#网卡类型（通常是Ethemet以太网）
PROXY_METHOD="none"	#代理方式：为关闭状态
BROWSER_ONLY="no"	#只是浏览器：否
BOOTPROTO="static"	#网卡的引导协议【static：静态IP  dhcp：动态IP   none：不指定，不指定容易出现各种各样的网络受限】
DEFROUTE="yes"		#默认路由
IPV4_FAILURE_FATAL="no"		#是否开启IPV4致命错误检测
IPV6INIT="yes"		#IPV6是否自动初始化：是（现在还未用到IPV6，不会有任何影响）
IPV6_AUTOCONF="yes"	#IPV6是否自动配置：是（现在还未用到IPV6，不会有任何影响）
IPV6_DEFROUTE="yes"	#IPV6是否可以为默认路由：是（现在还未用到IPV6，不会有任何影响）
IPV6_FAILURE_FATAL="no"		#是否开启IPV6致命错误检测
IPV6_ADDR_GEN_MODE="stable-privacy"	#IPV6地址生成模型
NAME=ens32			#网卡物理设备名称
UUID=197aa5b9-1e19-4109-be0d-5f825f15460c	#通用唯一识别码，每一个网卡都会有，不能重复，否则两台linux机器只有一台可上网
DEVICE=ens32	#网卡设备名称，必须和‘NAME’值一
ONBOOT=yes		#是否开机启动，要想网卡开机就启动或通过 `systemctl restart network`控制网卡,必须设置为 `yes`
IPADDR=192.168.1.155	# 本机IP
NETMASK=255.255.255.0	#子网掩码, 这里可以不用配置
GATEWAY=192.168.1.2		#网关需要配置和交换机的相同
```

## 配置域名解析器

如果`ping www.baidu.com`出现`ping: www.baidu.com: Name or service not known`需要配置域名解析器

修改`vim /etc/resolv.conf`

```shell
#Generated by NetworkManager
nameserver 114.114.114.114
nameserver 8.8.8.8
```

## 保存并重启网卡

- centOS6

  `service network restart`

- centOS7

  `systemctl restart network`

> 注意虚拟机不依赖宿主的adapter VMnet8 与外网交互, 而是通过交换机NAT机制将IP地址转换, 然后通过宿主机的真实网卡发送数据, 所以虚拟机能访问到宿主机。
>
> 宿主想要访问虚拟机就需要通adapter VMnet8， 才能访问到虚拟机
>
> 但是外网不能访问到虚拟机
>
<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-09-01_10-04-29.png"/>
>
<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-09-01_14-53-10.png"/>
>
<img src="..\..\..\..\..\imgs\_Linux\Snipaste_2020-09-01_14-54-30.png"/>
>
> 

