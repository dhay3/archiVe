# Spring 之 IOC

参考：

https://www.jianshu.com/p/17b66e6390fd

https://blog.csdn.net/ivan820819/article/details/79744797

[TOC]





## IOC理论背景

我们知道在面向对象设计的软件系统中，它的底层都是由N个对象构成的，各个对象之间通过相互合作，最终实现系统地业务逻辑。

<img src="C:\Users\82341\Desktop\30130748-488045b61d354b019a088b9cb7fc2d73.png"/>

​															图1 软件系统中耦合的对象

如果我们打开机械式手表的后盖，就会看到与上面类似的情形，各个齿轮分别带动时针、分针和秒针顺时针旋转，从而在表盘上产生正确的时间。图1中描述的就是这样的一个齿轮组，它拥有多个独立的齿轮，这些齿轮相互啮合在一起，协同工作，共同完成某项任务。我们可以看到，在这样的齿轮组中，如果有一个齿轮出了问题，就可能会影响到整个齿轮组的正常运转。

<img src="C:\Users\82341\Desktop\30131157-f547678cffaf421b89373e3bb308757d.png"/>

​																	图2 对象之间的依赖关系

齿轮组中齿轮之间的啮合关系,与软件系统中对象之间的耦合关系非常相似。对象之间的耦合关系是无法避免的，也是必要的，这是协同工作的基础。现在，伴随着工业级应用的规模越来越庞大，对象之间的依赖关系也越来越复杂，经常会出现对象之间的多重依赖性关系，因此，架构师和设计师对于系统的分析和设计，将面临更大的挑战。对象之间耦合度过高的系统，必然会出现牵一发而动全身的情形。

## 什么是IOC

**控制反转**（Inversion of Control，缩写为**IoC**），是面向对象编程中的一种设计原则，可以用来减低计算机代码之间的耦合度。其中最常见的方式叫做**依赖注入**（Dependency Injection，简称**DI**），还有一种方式叫“依赖查找”（Dependency Lookup，简称**DL**）。

==IOC理论提出的观点大体是这样的：借助于“第三方”实现具有依赖关系的对象之间的解耦==。如下图

<img src="C:\Users\82341\Desktop\30131727-a8268fe6370049028078e6b8a1cbc88f.png"/>

​																	  图3 IOC解耦过程

大家看到了吧，由于引进了中间位置的“第三方”，也就是IOC容器，使得A、B、C、D这4个对象没有了耦合关系，齿轮之间的传动全部依靠“第三方”了，全部对象的控制权全部上缴给“第三方”IOC容器，所以，IOC容器成了整个系统的关键核心，它起到了一种类似“粘合剂”的作用，把系统中的所有对象粘合在一起发挥作用，如果没有这个“粘合剂”，对象与对象之间会彼此失去联系，这就是有人把IOC容器比喻成“粘合剂”的由来。

## 为什么叫IOC

如图1所示，对象A依赖于对象B，那么对象A在初始化或者运行到某一点的时候，自己必须主动去创建对象B或者使用已经创建的对象B。无论是创建还是使用对象B，控制权都在自己手上。

 软件系统在引入IOC容器之后，这种情形就完全改变了，如图3所示，由于IOC容器的加入，对象A与对象B之间失去了直接联系，所以，当对象A运行到需要对象B的时候，IOC容器会主动创建一个对象B注入到对象A需要的地方。

  通过前后的对比，我们不难看出来：==对象A获得依赖对象B的过程,由主动行为变为了被动行为，控制权颠倒过来了，这就是“控制反转”这个名称的由来==。

## IOC也叫依赖注入(DI)

2004年，Martin Fowler探讨了同一个问题，既然IOC是控制反转，那么到底是“哪些方面的控制被反转了呢？”，经过详细地分析和论证后，他得出了答案：“获得依赖对象的过程被反转了”。控制被反转之后，获得依赖对象的过程由自身管理变为了由IOC容器主动注入。于是，他给“控制反转”取了一个更合适的名字叫做“依赖注入（Dependency Injection）”。他的这个答案，==实际上给出了实现IOC的方法：注入==。所谓依赖注入，就是由IOC容器在运行期间，动态地将某种依赖关系注入到对象之中。

　　所以，依赖注入(DI)和控制反转(IOC)是从不同的角度的描述的同一件事情，就是指通过引入IOC容器，利用依赖关系注入的方式，实现对象之间的解耦。

---

答：

IOC是一种设计模式，底层是工厂模式加反射实现的，假设现在有两个类A和B，现在A想要调用B类中的实例方法那么必须要主动创建一个B，那么A和B就会存在高耦合；现在有了另外一个类C，可以创建B的实例对象，A使用B时，A失去了主动权，不再主动创建B，而是通过C来实现，所以IOC也叫做控制反转，同时也降低了A和B的耦合度，这种方式同时也叫做DI，依赖注入

